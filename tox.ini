[tox]
envlist =
    # Test latest versions across all Python versions
    py{38,39,310,311}-latest
    # Test oldest supported versions
    py38-oldest
    # Test pydantic v1/v2 compatibility
    py311-pydantic1

[testenv]
deps =
    # Latest versions (default)
    latest: websockets
    latest: httpx
    latest: pydantic
    latest: pyaudio
    latest: typing-extensions>=3.7
    # Oldest supported versions
    oldest: websockets>=11.0.0,<12.0.0
    oldest: httpx>=0.21.0,<0.22.0
    oldest: pydantic>=1.7.0,<1.8.0
    oldest: pyaudio>=0.2.13,<0.3.0
    oldest: typing-extensions>=3.7
    # Pydantic v1 for compatibility testing
    pydantic1: websockets
    pydantic1: httpx
    pydantic1: pydantic>=1.10.0,<2.0.0,!=1.10.7
    pydantic1: pyaudio
    pydantic1: typing-extensions>=3.7
    # Test dependencies
    pytest
    pytest-httpx
    pytest-xdist
    pytest-mock
    pytest-cov
    factory-boy
allowlist_externals = pytest

commands = pytest -n auto --cov-report term --cov-report xml:coverage.xml --cov=assemblyai
